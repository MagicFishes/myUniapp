{"version":3,"file":"utils.js","sources":["utils/utils.js"],"sourcesContent":["/**\r\n * 工具方法：动态计算并缓存顶部安全区域与自定义导航栏高度。\r\n * 由于 uni-app 在部分平台存在获取系统信息延迟的问题，此处提供安全兜底和刷新能力。\r\n */\r\n\r\nconst DEFAULT_SAFE_TOP = 20\r\nconst DEFAULT_NAV_HEIGHT = 44\r\n// 底部导航栏高度  200\r\nconst DEFAULT_BOTTOM_NAV_HEIGHT = 110\r\n/**\r\n * 获取当前可用的平台 API（优先使用 uni）。\r\n */\r\nconst getPlatformApi = () => {\r\n\ttry {\r\n\t\tif (typeof uni !== 'undefined') {\r\n\t\t\treturn uni\r\n\t\t}\r\n\t} catch (error) {\r\n\t\t// ignore\r\n\t}\r\n\treturn undefined\r\n}\r\n\r\n/**\r\n * 计算顶部安全区域高度，优先使用 safeAreaInsets.top，其次回退到状态栏高度或默认值。\r\n */\r\nconst computeSafeTopHeight = () => {\r\n\tconst api = getPlatformApi()\r\n\tif (!api?.getSystemInfoSync) return DEFAULT_SAFE_TOP\r\n\r\n\ttry {\r\n\t\tconst info = api.getSystemInfoSync()\r\n\t\tif (info?.safeAreaInsets && typeof info.safeAreaInsets.top === 'number') {\r\n\t\t\treturn info.safeAreaInsets.top\r\n\t\t}\r\n\t\tif (typeof info?.statusBarHeight === 'number') {\r\n\t\t\treturn info.statusBarHeight\r\n\t\t}\r\n\t} catch (error) {\r\n\t\t// ignore and fall back\r\n\t}\r\n\r\n\treturn DEFAULT_SAFE_TOP\r\n}\r\n\r\n/**\r\n * 计算小程序/多端顶部胶囊按钮区域高度，失败时回退默认高度。\r\n */\r\nconst computeCustomNavBarHeight = () => {\r\n\tconst api = getPlatformApi()\r\n\tif (!api?.getMenuButtonBoundingClientRect) return DEFAULT_NAV_HEIGHT\r\n\r\n\ttry {\r\n\t\tconst rect = api.getMenuButtonBoundingClientRect()\r\n\t\tif (rect && typeof rect.height === 'number' && rect.height > 0) {\r\n\t\t\treturn rect.height\r\n\t\t}\r\n\t} catch (error) {\r\n\t\t// ignore and fall back\r\n\t}\r\n\r\n\treturn DEFAULT_NAV_HEIGHT\r\n}\r\n\r\nlet cachedSafeTopHeight\r\nlet cachedCustomNavBarHeight\r\n\r\n/**\r\n * 获取缓存的 safeTopHeight；若无缓存则重新计算并记录。\r\n */\r\nconst ensureSafeTopHeight = () => {\r\n\tif (typeof cachedSafeTopHeight === 'number') {\r\n\t\treturn cachedSafeTopHeight\r\n\t}\r\n\tcachedSafeTopHeight = computeSafeTopHeight()\r\n\treturn cachedSafeTopHeight\r\n}\r\n\r\n/**\r\n * 获取缓存的 customNavBarHeight；若无缓存则重新计算并记录。\r\n */\r\nconst ensureCustomNavBarHeight = () => {\r\n\tif (typeof cachedCustomNavBarHeight === 'number') {\r\n\t\treturn cachedCustomNavBarHeight\r\n\t}\r\n\tcachedCustomNavBarHeight = computeCustomNavBarHeight()\r\n\treturn cachedCustomNavBarHeight\r\n}\r\n\r\n/**\r\n * 主动刷新缓存，适用于设备旋转或系统信息变化后。\r\n */\r\nconst refreshMetrics = () => {\r\n\tcachedSafeTopHeight = undefined\r\n\tcachedCustomNavBarHeight = undefined\r\n}\r\n\r\nexport default {\r\n\t/**\r\n\t * 顶部安全区域高度（单位：px）\r\n\t */\r\n\tget safeTopHeight() {\r\n\t\treturn ensureSafeTopHeight()\r\n\t},\r\n\t/**\r\n\t * 自定义导航栏高度（单位：px）\r\n\t */\r\n\tget customNavBarHeight() {\r\n\t\treturn ensureCustomNavBarHeight()\r\n\t},\r\n\t/**\r\n\t * 顶部安全区域 + 自定义导航栏总高度，便于组件直接使用。\r\n\t */\r\n\tget totalSafeAreaHeight() {\r\n\t\treturn ensureSafeTopHeight() + ensureCustomNavBarHeight()\r\n\t},\r\n\t/**\r\n\t * 底部导航栏高度（单位：px）\r\n\t */\r\n\tget bottomNavHeight() {\r\n\t\treturn DEFAULT_BOTTOM_NAV_HEIGHT\r\n\t},\r\n\t/**\r\n\t * 主动刷新全部高度信息。\r\n\t */\r\n\trefresh: refreshMetrics\r\n}\r\n"],"names":["uni"],"mappings":";;AAKA,MAAM,mBAAmB;AACzB,MAAM,qBAAqB;AAE3B,MAAM,4BAA4B;AAIlC,MAAM,iBAAiB,MAAM;AAC5B,MAAI;AACH,QAAI,OAAOA,cAAG,UAAK,aAAa;AAC/B,aAAOA,cAAG;AAAA,IACV;AAAA,EACD,SAAQ,OAAO;AAAA,EAEf;AACD,SAAO;AACR;AAKA,MAAM,uBAAuB,MAAM;AAClC,QAAM,MAAM,eAAgB;AAC5B,MAAI,EAAC,2BAAK;AAAmB,WAAO;AAEpC,MAAI;AACH,UAAM,OAAO,IAAI,kBAAmB;AACpC,SAAI,6BAAM,mBAAkB,OAAO,KAAK,eAAe,QAAQ,UAAU;AACxE,aAAO,KAAK,eAAe;AAAA,IAC3B;AACD,QAAI,QAAO,6BAAM,qBAAoB,UAAU;AAC9C,aAAO,KAAK;AAAA,IACZ;AAAA,EACD,SAAQ,OAAO;AAAA,EAEf;AAED,SAAO;AACR;AAKA,MAAM,4BAA4B,MAAM;AACvC,QAAM,MAAM,eAAgB;AAC5B,MAAI,EAAC,2BAAK;AAAiC,WAAO;AAElD,MAAI;AACH,UAAM,OAAO,IAAI,gCAAiC;AAClD,QAAI,QAAQ,OAAO,KAAK,WAAW,YAAY,KAAK,SAAS,GAAG;AAC/D,aAAO,KAAK;AAAA,IACZ;AAAA,EACD,SAAQ,OAAO;AAAA,EAEf;AAED,SAAO;AACR;AAEA,IAAI;AACJ,IAAI;AAKJ,MAAM,sBAAsB,MAAM;AACjC,MAAI,OAAO,wBAAwB,UAAU;AAC5C,WAAO;AAAA,EACP;AACD,wBAAsB,qBAAsB;AAC5C,SAAO;AACR;AAKA,MAAM,2BAA2B,MAAM;AACtC,MAAI,OAAO,6BAA6B,UAAU;AACjD,WAAO;AAAA,EACP;AACD,6BAA2B,0BAA2B;AACtD,SAAO;AACR;AAKA,MAAM,iBAAiB,MAAM;AAC5B,wBAAsB;AACtB,6BAA2B;AAC5B;AAEA,MAAe,aAAA;AAAA;AAAA;AAAA;AAAA,EAId,IAAI,gBAAgB;AACnB,WAAO,oBAAqB;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA,EAID,IAAI,qBAAqB;AACxB,WAAO,yBAA0B;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAID,IAAI,sBAAsB;AACzB,WAAO,oBAAqB,IAAG,yBAA0B;AAAA,EACzD;AAAA;AAAA;AAAA;AAAA,EAID,IAAI,kBAAkB;AACrB,WAAO;AAAA,EACP;AAAA;AAAA;AAAA;AAAA,EAID,SAAS;AACV;;"}