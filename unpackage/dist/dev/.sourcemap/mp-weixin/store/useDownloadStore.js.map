{"version":3,"file":"useDownloadStore.js","sources":["store/useDownloadStore.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\n\r\nconst STORAGE_KEY = 'ANYDOOR_DOWNLOAD_TASKS'\r\n\r\nconst safeStorage = {\r\n\tget() {\r\n\t\tif (typeof uni !== 'undefined' && uni.getStorageSync) {\r\n\t\t\treturn uni.getStorageSync(STORAGE_KEY)\r\n\t\t}\r\n\t\tif (typeof localStorage !== 'undefined') {\r\n\t\t\tconst cached = localStorage.getItem(STORAGE_KEY)\r\n\t\t\treturn cached ? JSON.parse(cached) : []\r\n\t\t}\r\n\t\treturn []\r\n\t},\r\n\tset(value) {\r\n\t\tconst payload = JSON.parse(JSON.stringify(value))\r\n\t\tif (typeof uni !== 'undefined' && uni.setStorageSync) {\r\n\t\t\tuni.setStorageSync(STORAGE_KEY, payload)\r\n\t\t} else if (typeof localStorage !== 'undefined') {\r\n\t\t\tlocalStorage.setItem(STORAGE_KEY, JSON.stringify(payload))\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport const useDownloadStore = defineStore('download', {\r\n\tstate: () => ({\r\n\t\ttasks: safeStorage.get() || []\r\n\t}),\r\n\tgetters: {\r\n\t\tactiveTasks: (state) => state.tasks.filter((item) => item.status === 'pending' || item.status === 'downloading'),\r\n\t\tcompletedTasks: (state) => state.tasks.filter((item) => item.status === 'success'),\r\n\t\tfailedTasks: (state) => state.tasks.filter((item) => item.status === 'error')\r\n\t},\r\n\tactions: {\r\n\t\taddTask(payload) {\r\n\t\t\tconst exists = this.tasks.find((item) => item.id === payload.id)\r\n\t\t\tif (exists) return\r\n\t\t\tthis.tasks.unshift({\r\n\t\t\t\tid: payload.id,\r\n\t\t\t\tname: payload.name || '未命名文件',\r\n\t\t\t\tprogress: payload.progress || 0,\r\n\t\t\t\tstatus: payload.status || 'pending',\r\n\t\t\t\tcreatedAt: payload.createdAt || Date.now(),\r\n\t\t\t\tmeta: payload.meta || {}\r\n\t\t\t})\r\n\t\t\tthis.persist()\r\n\t\t},\r\n\t\tupdateTask(id, data) {\r\n\t\t\tconst target = this.tasks.find((item) => item.id === id)\r\n\t\t\tif (!target) return\r\n\t\t\tObject.assign(target, data)\r\n\t\t\tif (typeof data.progress === 'number') {\r\n\t\t\t\ttarget.progress = Math.min(100, Math.max(0, data.progress))\r\n\t\t\t}\r\n\t\t\tthis.persist()\r\n\t\t},\r\n\t\tremoveTask(id) {\r\n\t\t\tthis.tasks = this.tasks.filter((item) => item.id !== id)\r\n\t\t\tthis.persist()\r\n\t\t},\r\n\t\tclearAll() {\r\n\t\t\tthis.tasks = []\r\n\t\t\tthis.persist()\r\n\t\t},\r\n\t\tpersist() {\r\n\t\t\tsafeStorage.set(this.tasks)\r\n\t\t}\r\n\t}\r\n})\r\n\r\n"],"names":["uni","defineStore"],"mappings":";;AAEA,MAAM,cAAc;AAEpB,MAAM,cAAc;AAAA,EACnB,MAAM;AACL,QAAI,OAAOA,cAAG,UAAK,eAAeA,cAAAA,MAAI,gBAAgB;AACrD,aAAOA,cAAG,MAAC,eAAe,WAAW;AAAA,IACrC;AACD,QAAI,OAAO,iBAAiB,aAAa;AACxC,YAAM,SAAS,aAAa,QAAQ,WAAW;AAC/C,aAAO,SAAS,KAAK,MAAM,MAAM,IAAI,CAAE;AAAA,IACvC;AACD,WAAO,CAAE;AAAA,EACT;AAAA,EACD,IAAI,OAAO;AACV,UAAM,UAAU,KAAK,MAAM,KAAK,UAAU,KAAK,CAAC;AAChD,QAAI,OAAOA,cAAG,UAAK,eAAeA,cAAAA,MAAI,gBAAgB;AACrDA,0BAAI,eAAe,aAAa,OAAO;AAAA,IAC1C,WAAa,OAAO,iBAAiB,aAAa;AAC/C,mBAAa,QAAQ,aAAa,KAAK,UAAU,OAAO,CAAC;AAAA,IACzD;AAAA,EACD;AACF;AAEgCC,cAAW,YAAC,YAAY;AAAA,EACvD,OAAO,OAAO;AAAA,IACb,OAAO,YAAY,IAAG,KAAM,CAAE;AAAA,EAChC;AAAA,EACC,SAAS;AAAA,IACR,aAAa,CAAC,UAAU,MAAM,MAAM,OAAO,CAAC,SAAS,KAAK,WAAW,aAAa,KAAK,WAAW,aAAa;AAAA,IAC/G,gBAAgB,CAAC,UAAU,MAAM,MAAM,OAAO,CAAC,SAAS,KAAK,WAAW,SAAS;AAAA,IACjF,aAAa,CAAC,UAAU,MAAM,MAAM,OAAO,CAAC,SAAS,KAAK,WAAW,OAAO;AAAA,EAC5E;AAAA,EACD,SAAS;AAAA,IACR,QAAQ,SAAS;AAChB,YAAM,SAAS,KAAK,MAAM,KAAK,CAAC,SAAS,KAAK,OAAO,QAAQ,EAAE;AAC/D,UAAI;AAAQ;AACZ,WAAK,MAAM,QAAQ;AAAA,QAClB,IAAI,QAAQ;AAAA,QACZ,MAAM,QAAQ,QAAQ;AAAA,QACtB,UAAU,QAAQ,YAAY;AAAA,QAC9B,QAAQ,QAAQ,UAAU;AAAA,QAC1B,WAAW,QAAQ,aAAa,KAAK,IAAK;AAAA,QAC1C,MAAM,QAAQ,QAAQ,CAAE;AAAA,MAC5B,CAAI;AACD,WAAK,QAAS;AAAA,IACd;AAAA,IACD,WAAW,IAAI,MAAM;AACpB,YAAM,SAAS,KAAK,MAAM,KAAK,CAAC,SAAS,KAAK,OAAO,EAAE;AACvD,UAAI,CAAC;AAAQ;AACb,aAAO,OAAO,QAAQ,IAAI;AAC1B,UAAI,OAAO,KAAK,aAAa,UAAU;AACtC,eAAO,WAAW,KAAK,IAAI,KAAK,KAAK,IAAI,GAAG,KAAK,QAAQ,CAAC;AAAA,MAC1D;AACD,WAAK,QAAS;AAAA,IACd;AAAA,IACD,WAAW,IAAI;AACd,WAAK,QAAQ,KAAK,MAAM,OAAO,CAAC,SAAS,KAAK,OAAO,EAAE;AACvD,WAAK,QAAS;AAAA,IACd;AAAA,IACD,WAAW;AACV,WAAK,QAAQ,CAAE;AACf,WAAK,QAAS;AAAA,IACd;AAAA,IACD,UAAU;AACT,kBAAY,IAAI,KAAK,KAAK;AAAA,IAC1B;AAAA,EACD;AACF,CAAC;"}